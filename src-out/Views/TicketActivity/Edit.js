define('crm/Views/TicketActivity/Edit', ['module', 'exports', 'dojo/_base/declare', 'dojo/_base/lang', '../../Template', '../../Validator', 'argos/ErrorManager', 'argos/Edit', 'argos/I18n', '../../Models/Names'], function (module, exports, _declare, _lang, _Template, _Validator, _ErrorManager, _Edit, _I18n, _Names) {
  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _declare2 = _interopRequireDefault(_declare);

  var _lang2 = _interopRequireDefault(_lang);

  var _Template2 = _interopRequireDefault(_Template);

  var _Validator2 = _interopRequireDefault(_Validator);

  var _ErrorManager2 = _interopRequireDefault(_ErrorManager);

  var _Edit2 = _interopRequireDefault(_Edit);

  var _I18n2 = _interopRequireDefault(_I18n);

  var _Names2 = _interopRequireDefault(_Names);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  /* Copyright 2017 Infor
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *    http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */

  var resource = (0, _I18n2.default)('ticketActivityEdit');
  var dtFormatResource = (0, _I18n2.default)('ticketActivityEditDateTimeFormat');

  /**
   * @class crm.Views.TicketActivity.Edit
   *
   * @extends argos.Edit
   *
   * @requires argos.ErrorManager
   *
   * @requires crm.Template
   * @requires crm.Validator
   */
  var __class = (0, _declare2.default)('crm.Views.TicketActivity.Edit', [_Edit2.default], {
    // Localization
    titleText: resource.titleText,
    activityTypeText: resource.activityTypeText,
    activityTypeTitleText: resource.activityTypeTitleText,
    publicAccessText: resource.publicAccessText,
    publicAccessTitleText: resource.publicAccessTitleText,
    userText: resource.userText,
    startDateText: resource.startDateText,
    endDateText: resource.endDateText,
    commentsText: resource.commentsText,
    startingFormatText: dtFormatResource.startingFormatText,
    startingFormatText24: dtFormatResource.startingFormatText24,

    // View Properties
    entityName: 'TicketActivity',
    id: 'ticketactivity_edit',
    querySelect: [],
    queryInclude: [],
    modelName: _Names2.default.TICKETACTIVITY,
    resourceKind: 'ticketActivities',

    processTemplateEntry: function processTemplateEntry(entry) {
      this.inherited(processTemplateEntry, arguments);

      if (entry.PublicAccessCode) {
        this.requestCodeData('name eq "Ticket Activity Public Access"', entry.PublicAccessCode, this.fields.PublicAccessCode);
      }
    },
    createPicklistRequest: function createPicklistRequest(name) {
      var request = new Sage.SData.Client.SDataResourceCollectionRequest(App.getService()).setResourceKind('picklists').setContractName('system');

      var uri = request.getUri();
      uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex, 'items');
      uri.setCollectionPredicate(name);

      request.allowCacheUse = true;
      return request;
    },
    requestCodeData: function requestCodeData(picklistName, code, field) {
      var request = this.createPicklistRequest(picklistName);
      request.read({
        success: _lang2.default.hitch(this, this.onRequestCodeDataSuccess, code, field),
        failure: this.onRequestCodeDataFailure,
        scope: this
      });
    },
    onRequestCodeDataSuccess: function onRequestCodeDataSuccess(code, field, feed) {
      var value = this.processCodeDataFeed(feed, code);
      field.setValue(code);
      field.setText(value);
    },
    onRequestCodeDataFailure: function onRequestCodeDataFailure(response, o) {
      _ErrorManager2.default.addError(response, o, this.options, 'failure');
    },
    processCodeDataFeed: function processCodeDataFeed(feed, currentValue, options) {
      var keyProperty = options && options.keyProperty ? options.keyProperty : '$key';
      var textProperty = options && options.textProperty ? options.textProperty : 'text';

      for (var i = 0; i < feed.$resources.length; i++) {
        if (feed.$resources[i][keyProperty] === currentValue) {
          return feed.$resources[i][textProperty];
        }
      }

      return currentValue;
    },

    applyContext: function applyContext() {
      this.inherited(applyContext, arguments);

      var ticketContext = App.isNavigationFromResourceKind(['tickets']);
      var ticketKey = ticketContext && ticketContext.key;
      var user = App.context.user;
      var userField = this.fields.User;

      if (ticketKey) {
        this.fields.TicketId.setValue(ticketKey);
      }

      if (userField) {
        userField.setValue(user);
      }
    },

    createLayout: function createLayout() {
      return this.layout || (this.layout = [{
        name: 'TicketId',
        property: 'Ticket.$key',
        type: 'hidden'
      }, {
        label: this.commentsText,
        name: 'ActivityDescription',
        property: 'ActivityDescription',
        rows: 6,
        type: 'textarea'
      }, {
        label: this.activityTypeText,
        name: 'ActivityTypeCode',
        property: 'ActivityTypeCode',
        requireSelection: true,
        title: this.activityTypeTitleText,
        storageMode: 'id',
        picklist: 'Ticket Activity',
        type: 'picklist'
      }, {
        label: this.publicAccessText,
        name: 'PublicAccessCode',
        property: 'PublicAccessCode',
        title: this.publicAccessTitleText,
        storageMode: 'id',
        picklist: 'Ticket Activity Public Access',
        type: 'picklist'
      }, {
        label: this.userText,
        name: 'User',
        property: 'User',
        textProperty: 'UserInfo',
        textTemplate: _Template2.default.nameLF,
        type: 'lookup',
        view: 'user_list'
      }, {
        label: this.startDateText,
        name: 'AssignedDate',
        property: 'AssignedDate',
        type: 'date',
        showTimePicker: true,
        dateFormatText: App.is24HourClock() ? this.startingFormatText24 : this.startingFormatText,
        minValue: new Date(1900, 0, 1),
        validator: [_Validator2.default.exists, _Validator2.default.isDateInRange]
      }, {
        label: this.endDateText,
        name: 'CompletedDate',
        property: 'CompletedDate',
        type: 'date',
        showTimePicker: true,
        dateFormatText: App.is24HourClock() ? this.startingFormatText24 : this.startingFormatText,
        minValue: new Date(1900, 0, 1),
        validator: [_Validator2.default.exists, _Validator2.default.isDateInRange]
      }]);
    }
  });

  exports.default = __class;
  module.exports = exports['default'];
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9WaWV3cy9UaWNrZXRBY3Rpdml0eS9FZGl0LmpzIl0sIm5hbWVzIjpbInJlc291cmNlIiwiZHRGb3JtYXRSZXNvdXJjZSIsIl9fY2xhc3MiLCJ0aXRsZVRleHQiLCJhY3Rpdml0eVR5cGVUZXh0IiwiYWN0aXZpdHlUeXBlVGl0bGVUZXh0IiwicHVibGljQWNjZXNzVGV4dCIsInB1YmxpY0FjY2Vzc1RpdGxlVGV4dCIsInVzZXJUZXh0Iiwic3RhcnREYXRlVGV4dCIsImVuZERhdGVUZXh0IiwiY29tbWVudHNUZXh0Iiwic3RhcnRpbmdGb3JtYXRUZXh0Iiwic3RhcnRpbmdGb3JtYXRUZXh0MjQiLCJlbnRpdHlOYW1lIiwiaWQiLCJxdWVyeVNlbGVjdCIsInF1ZXJ5SW5jbHVkZSIsIm1vZGVsTmFtZSIsIlRJQ0tFVEFDVElWSVRZIiwicmVzb3VyY2VLaW5kIiwicHJvY2Vzc1RlbXBsYXRlRW50cnkiLCJlbnRyeSIsImluaGVyaXRlZCIsImFyZ3VtZW50cyIsIlB1YmxpY0FjY2Vzc0NvZGUiLCJyZXF1ZXN0Q29kZURhdGEiLCJmaWVsZHMiLCJjcmVhdGVQaWNrbGlzdFJlcXVlc3QiLCJuYW1lIiwicmVxdWVzdCIsIlNhZ2UiLCJTRGF0YSIsIkNsaWVudCIsIlNEYXRhUmVzb3VyY2VDb2xsZWN0aW9uUmVxdWVzdCIsIkFwcCIsImdldFNlcnZpY2UiLCJzZXRSZXNvdXJjZUtpbmQiLCJzZXRDb250cmFjdE5hbWUiLCJ1cmkiLCJnZXRVcmkiLCJzZXRQYXRoU2VnbWVudCIsIlNEYXRhVXJpIiwiUmVzb3VyY2VQcm9wZXJ0eUluZGV4Iiwic2V0Q29sbGVjdGlvblByZWRpY2F0ZSIsImFsbG93Q2FjaGVVc2UiLCJwaWNrbGlzdE5hbWUiLCJjb2RlIiwiZmllbGQiLCJyZWFkIiwic3VjY2VzcyIsImhpdGNoIiwib25SZXF1ZXN0Q29kZURhdGFTdWNjZXNzIiwiZmFpbHVyZSIsIm9uUmVxdWVzdENvZGVEYXRhRmFpbHVyZSIsInNjb3BlIiwiZmVlZCIsInZhbHVlIiwicHJvY2Vzc0NvZGVEYXRhRmVlZCIsInNldFZhbHVlIiwic2V0VGV4dCIsInJlc3BvbnNlIiwibyIsImFkZEVycm9yIiwib3B0aW9ucyIsImN1cnJlbnRWYWx1ZSIsImtleVByb3BlcnR5IiwidGV4dFByb3BlcnR5IiwiaSIsIiRyZXNvdXJjZXMiLCJsZW5ndGgiLCJhcHBseUNvbnRleHQiLCJ0aWNrZXRDb250ZXh0IiwiaXNOYXZpZ2F0aW9uRnJvbVJlc291cmNlS2luZCIsInRpY2tldEtleSIsImtleSIsInVzZXIiLCJjb250ZXh0IiwidXNlckZpZWxkIiwiVXNlciIsIlRpY2tldElkIiwiY3JlYXRlTGF5b3V0IiwibGF5b3V0IiwicHJvcGVydHkiLCJ0eXBlIiwibGFiZWwiLCJyb3dzIiwicmVxdWlyZVNlbGVjdGlvbiIsInRpdGxlIiwic3RvcmFnZU1vZGUiLCJwaWNrbGlzdCIsInRleHRUZW1wbGF0ZSIsIm5hbWVMRiIsInZpZXciLCJzaG93VGltZVBpY2tlciIsImRhdGVGb3JtYXRUZXh0IiwiaXMyNEhvdXJDbG9jayIsIm1pblZhbHVlIiwiRGF0ZSIsInZhbGlkYXRvciIsImV4aXN0cyIsImlzRGF0ZUluUmFuZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7QUF3QkEsTUFBTUEsV0FBVyxvQkFBWSxvQkFBWixDQUFqQjtBQUNBLE1BQU1DLG1CQUFtQixvQkFBWSxrQ0FBWixDQUF6Qjs7QUFFQTs7Ozs7Ozs7OztBQVVBLE1BQU1DLFVBQVUsdUJBQVEsK0JBQVIsRUFBeUMsZ0JBQXpDLEVBQWlEO0FBQy9EO0FBQ0FDLGVBQVdILFNBQVNHLFNBRjJDO0FBRy9EQyxzQkFBa0JKLFNBQVNJLGdCQUhvQztBQUkvREMsMkJBQXVCTCxTQUFTSyxxQkFKK0I7QUFLL0RDLHNCQUFrQk4sU0FBU00sZ0JBTG9DO0FBTS9EQywyQkFBdUJQLFNBQVNPLHFCQU4rQjtBQU8vREMsY0FBVVIsU0FBU1EsUUFQNEM7QUFRL0RDLG1C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UURDLG1CQUFXLENBQ1Qsb0JBQVVDLE1BREQsRUFFVCxvQkFBVUMsYUFGRDtBQVJWLE9BL0NrQyxDQUE5QixDQUFQO0FBNEREO0FBcEo4RCxHQUFqRCxDQUFoQjs7b0JBdUplbkcsTyIsImZpbGUiOiJFZGl0LmpzIiwic291cmNlUm9vdCI6InNyYyIsInNvdXJjZXNDb250ZW50IjpbIi8qIENvcHlyaWdodCAyMDE3IEluZm9yXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IGRlY2xhcmUgZnJvbSAnZG9qby9fYmFzZS9kZWNsYXJlJztcclxuaW1wb3J0IGxhbmcgZnJvbSAnZG9qby9fYmFzZS9sYW5nJztcclxuaW1wb3J0IHRlbXBsYXRlIGZyb20gJy4uLy4uL1RlbXBsYXRlJztcclxuaW1wb3J0IHZhbGlkYXRvciBmcm9tICcuLi8uLi9WYWxpZGF0b3InO1xyXG5pbXBvcnQgRXJyb3JNYW5hZ2VyIGZyb20gJ2FyZ29zL0Vycm9yTWFuYWdlcic7XHJcbmltcG9ydCBFZGl0IGZyb20gJ2FyZ29zL0VkaXQnO1xyXG5pbXBvcnQgZ2V0UmVzb3VyY2UgZnJvbSAnYXJnb3MvSTE4bic7XHJcbmltcG9ydCBNT0RFTF9OQU1FUyBmcm9tICcuLi8uLi9Nb2RlbHMvTmFtZXMnO1xyXG5cclxuY29uc3QgcmVzb3VyY2UgPSBnZXRSZXNvdXJjZSgndGlja2V0QWN0aXZpdHlFZGl0Jyk7XHJcbmNvbnN0IGR0Rm9ybWF0UmVzb3VyY2UgPSBnZXRSZXNvdXJjZSgndGlja2V0QWN0aXZpdHlFZGl0RGF0ZVRpbWVGb3JtYXQnKTtcclxuXHJcbi8qKlxyXG4gKiBAY2xhc3MgY3JtLlZpZXdzLlRpY2tldEFjdGl2aXR5LkVkaXRcclxuICpcclxuICogQGV4dGVuZHMgYXJnb3MuRWRpdFxyXG4gKlxyXG4gKiBAcmVxdWlyZXMgYXJnb3MuRXJyb3JNYW5hZ2VyXHJcbiAqXHJcbiAqIEByZXF1aXJlcyBjcm0uVGVtcGxhdGVcclxuICogQHJlcXVpcmVzIGNybS5WYWxpZGF0b3JcclxuICovXHJcbmNvbnN0IF9fY2xhc3MgPSBkZWNsYXJlKCdjcm0uVmlld3MuVGlja2V0QWN0aXZpdHkuRWRpdCcsIFtFZGl0XSwge1xyXG4gIC8vIExvY2FsaXphdGlvblxyXG4gIHRpdGxlVGV4dDogcmVzb3VyY2UudGl0bGVUZXh0LFxyXG4gIGFjdGl2aXR5VHlwZVRleHQ6IHJlc291cmNlLmFjdGl2aXR5VHlwZVRleHQsXHJcbiAgYWN0aXZpdHlUeXBlVGl0bGVUZXh0OiByZXNvdXJjZS5hY3Rpdml0eVR5cGVUaXRsZVRleHQsXHJcbiAgcHVibGljQWNjZXNzVGV4dDogcmVzb3VyY2UucHVibGljQWNjZXNzVGV4dCxcclxuICBwdWJsaWNBY2Nlc3NUaXRsZVRleHQ6IHJlc291cmNlLnB1YmxpY0FjY2Vzc1RpdGxlVGV4dCxcclxuICB1c2VyVGV4dDogcmVzb3VyY2UudXNlclRleHQsXHJcbiAgc3RhcnREYXRlVGV4dDogcmVzb3VyY2Uuc3RhcnREYXRlVGV4dCxcclxuICBlbmREYXRlVGV4dDogcmVzb3VyY2UuZW5kRGF0ZVRleHQsXHJcbiAgY29tbWVudHNUZXh0OiByZXNvdXJjZS5jb21tZW50c1RleHQsXHJcbiAgc3RhcnRpbmdGb3JtYXRUZXh0OiBkdEZvcm1hdFJlc291cmNlLnN0YXJ0aW5nRm9ybWF0VGV4dCxcclxuICBzdGFydGluZ0Zvcm1hdFRleHQyNDogZHRGb3JtYXRSZXNvdXJjZS5zdGFydGluZ0Zvcm1hdFRleHQyNCxcclxuXHJcbiAgLy8gVmlldyBQcm9wZXJ0aWVzXHJcbiAgZW50aXR5TmFtZTogJ1RpY2tldEFjdGl2aXR5JyxcclxuICBpZDogJ3RpY2tldGFjdGl2aXR5X2VkaXQnLFxyXG4gIHF1ZXJ5U2VsZWN0OiBbXSxcclxuICBxdWVyeUluY2x1ZGU6IFtdLFxyXG4gIG1vZGVsTmFtZTogTU9ERUxfTkFNRVMuVElDS0VUQUNUSVZJVFksXHJcbiAgcmVzb3VyY2VLaW5kOiAndGlja2V0QWN0aXZpdGllcycsXHJcblxyXG4gIHByb2Nlc3NUZW1wbGF0ZUVudHJ5OiBmdW5jdGlvbiBwcm9jZXNzVGVtcGxhdGVFbnRyeShlbnRyeSkge1xyXG4gICAgdGhpcy5pbmhlcml0ZWQocHJvY2Vzc1RlbXBsYXRlRW50cnksIGFyZ3VtZW50cyk7XHJcblxyXG4gICAgaWYgKGVudHJ5LlB1YmxpY0FjY2Vzc0NvZGUpIHtcclxuICAgICAgdGhpcy5yZXF1ZXN0Q29kZURhdGEoJ25hbWUgZXEgXCJUaWNrZXQgQWN0aXZpdHkgUHVibGljIEFjY2Vzc1wiJywgZW50cnkuUHVibGljQWNjZXNzQ29kZSwgdGhpcy5maWVsZHMuUHVibGljQWNjZXNzQ29kZSk7XHJcbiAgICB9XHJcbiAgfSxcclxuICBjcmVhdGVQaWNrbGlzdFJlcXVlc3Q6IGZ1bmN0aW9uIGNyZWF0ZVBpY2tsaXN0UmVxdWVzdChuYW1lKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFNhZ2UuU0RhdGEuQ2xpZW50LlNEYXRhUmVzb3VyY2VDb2xsZWN0aW9uUmVxdWVzdChBcHAuZ2V0U2VydmljZSgpKVxyXG4gICAgICAuc2V0UmVzb3VyY2VLaW5kKCdwaWNrbGlzdHMnKVxyXG4gICAgICAuc2V0Q29udHJhY3ROYW1lKCdzeXN0ZW0nKTtcclxuXHJcbiAgICBjb25zdCB1cmkgPSByZXF1ZXN0LmdldFVyaSgpO1xyXG4gICAgdXJpLnNldFBhdGhTZWdtZW50KFNhZ2UuU0RhdGEuQ2xpZW50LlNEYXRhVXJpLlJlc291cmNlUHJvcGVydHlJbmRleCwgJ2l0ZW1zJyk7XHJcbiAgICB1cmkuc2V0Q29sbGVjdGlvblByZWRpY2F0ZShuYW1lKTtcclxuXHJcbiAgICByZXF1ZXN0LmFsbG93Q2FjaGVVc2UgPSB0cnVlO1xyXG4gICAgcmV0dXJuIHJlcXVlc3Q7XHJcbiAgfSxcclxuICByZXF1ZXN0Q29kZURhdGE6IGZ1bmN0aW9uIHJlcXVlc3RDb2RlRGF0YShwaWNrbGlzdE5hbWUsIGNvZGUsIGZpZWxkKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5jcmVhdGVQaWNrbGlzdFJlcXVlc3QocGlja2xpc3ROYW1lKTtcclxuICAgIHJlcXVlc3QucmVhZCh7XHJcbiAgICAgIHN1Y2Nlc3M6IGxhbmcuaGl0Y2godGhpcywgdGhpcy5vblJlcXVlc3RDb2RlRGF0YVN1Y2Nlc3MsIGNvZGUsIGZpZWxkKSxcclxuICAgICAgZmFpbHVyZTogdGhpcy5vblJlcXVlc3RDb2RlRGF0YUZhaWx1cmUsXHJcbiAgICAgIHNjb3BlOiB0aGlzLFxyXG4gICAgfSk7XHJcbiAgfSxcclxuICBvblJlcXVlc3RDb2RlRGF0YVN1Y2Nlc3M6IGZ1bmN0aW9uIG9uUmVxdWVzdENvZGVEYXRhU3VjY2Vzcyhjb2RlLCBmaWVsZCwgZmVlZCkge1xyXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLnByb2Nlc3NDb2RlRGF0YUZlZWQoZmVlZCwgY29kZSk7XHJcbiAgICBmaWVsZC5zZXRWYWx1ZShjb2RlKTtcclxuICAgIGZpZWxkLnNldFRleHQodmFsdWUpO1xyXG4gIH0sXHJcbiAgb25SZXF1ZXN0Q29kZURhdGFGYWlsdXJlOiBmdW5jdGlvbiBvblJlcXVlc3RDb2RlRGF0YUZhaWx1cmUocmVzcG9uc2UsIG8pIHtcclxuICAgIEVycm9yTWFuYWdlci5hZGRFcnJvcihyZXNwb25zZSwgbywgdGhpcy5vcHRpb25zLCAnZmFpbHVyZScpO1xyXG4gIH0sXHJcbiAgcHJvY2Vzc0NvZGVEYXRhRmVlZDogZnVuY3Rpb24gcHJvY2Vzc0NvZGVEYXRhRmVlZChmZWVkLCBjdXJyZW50VmFsdWUsIG9wdGlvbnMpIHtcclxuICAgIGNvbnN0IGtleVByb3BlcnR5ID0gb3B0aW9ucyAmJiBvcHRpb25zLmtleVByb3BlcnR5ID8gb3B0aW9ucy5rZXlQcm9wZXJ0eSA6ICcka2V5JztcclxuICAgIGNvbnN0IHRleHRQcm9wZXJ0eSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50ZXh0UHJvcGVydHkgPyBvcHRpb25zLnRleHRQcm9wZXJ0eSA6ICd0ZXh0JztcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZlZWQuJHJlc291cmNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAoZmVlZC4kcmVzb3VyY2VzW2ldW2tleVByb3BlcnR5XSA9PT0gY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZlZWQuJHJlc291cmNlc1tpXVt0ZXh0UHJvcGVydHldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGN1cnJlbnRWYWx1ZTtcclxuICB9LFxyXG5cclxuICBhcHBseUNvbnRleHQ6IGZ1bmN0aW9uIGFwcGx5Q29udGV4dCgpIHtcclxuICAgIHRoaXMuaW5oZXJpdGVkKGFwcGx5Q29udGV4dCwgYXJndW1lbnRzKTtcclxuXHJcbiAgICBjb25zdCB0aWNrZXRDb250ZXh0ID0gQXBwLmlzTmF2aWdhdGlvbkZyb21SZXNvdXJjZUtpbmQoWyd0aWNrZXRzJ10pO1xyXG4gICAgY29uc3QgdGlja2V0S2V5ID0gdGlja2V0Q29udGV4dCAmJiB0aWNrZXRDb250ZXh0LmtleTtcclxuICAgIGNvbnN0IHVzZXIgPSBBcHAuY29udGV4dC51c2VyO1xyXG4gICAgY29uc3QgdXNlckZpZWxkID0gdGhpcy5maWVsZHMuVXNlcjtcclxuXHJcbiAgICBpZiAodGlja2V0S2V5KSB7XHJcbiAgICAgIHRoaXMuZmllbGRzLlRpY2tldElkLnNldFZhbHVlKHRpY2tldEtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHVzZXJGaWVsZCkge1xyXG4gICAgICB1c2VyRmllbGQuc2V0VmFsdWUodXNlcik7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlTGF5b3V0OiBmdW5jdGlvbiBjcmVhdGVMYXlvdXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5sYXlvdXQgfHwgKHRoaXMubGF5b3V0ID0gW3tcclxuICAgICAgbmFtZTogJ1RpY2tldElkJyxcclxuICAgICAgcHJvcGVydHk6ICdUaWNrZXQuJGtleScsXHJcbiAgICAgIHR5cGU6ICdoaWRkZW4nLFxyXG4gICAgfSwge1xyXG4gICAgICBsYWJlbDogdGhpcy5jb21tZW50c1RleHQsXHJcbiAgICAgIG5hbWU6ICdBY3Rpdml0eURlc2NyaXB0aW9uJyxcclxuICAgICAgcHJvcGVydHk6ICdBY3Rpdml0eURlc2NyaXB0aW9uJyxcclxuICAgICAgcm93czogNixcclxuICAgICAgdHlwZTogJ3RleHRhcmVhJyxcclxuICAgIH0sIHtcclxuICAgICAgbGFiZWw6IHRoaXMuYWN0aXZpdHlUeXBlVGV4dCxcclxuICAgICAgbmFtZTogJ0FjdGl2aXR5VHlwZUNvZGUnLFxyXG4gICAgICBwcm9wZXJ0eTogJ0FjdGl2aXR5VHlwZUNvZGUnLFxyXG4gICAgICByZXF1aXJlU2VsZWN0aW9uOiB0cnVlLFxyXG4gICAgICB0aXRsZTogdGhpcy5hY3Rpdml0eVR5cGVUaXRsZVRleHQsXHJcbiAgICAgIHN0b3JhZ2VNb2RlOiAnaWQnLFxyXG4gICAgICBwaWNrbGlzdDogJ1RpY2tldCBBY3Rpdml0eScsXHJcbiAgICAgIHR5cGU6ICdwaWNrbGlzdCcsXHJcbiAgICB9LCB7XHJcbiAgICAgIGxhYmVsOiB0aGlzLnB1YmxpY0FjY2Vzc1RleHQsXHJcbiAgICAgIG5hbWU6ICdQdWJsaWNBY2Nlc3NDb2RlJyxcclxuICAgICAgcHJvcGVydHk6ICdQdWJsaWNBY2Nlc3NDb2RlJyxcclxuICAgICAgdGl0bGU6IHRoaXMucHVibGljQWNjZXNzVGl0bGVUZXh0LFxyXG4gICAgICBzdG9yYWdlTW9kZTogJ2lkJyxcclxuICAgICAgcGlja2xpc3Q6ICdUaWNrZXQgQWN0aXZpdHkgUHVibGljIEFjY2VzcycsXHJcbiAgICAgIHR5cGU6ICdwaWNrbGlzdCcsXHJcbiAgICB9LCB7XHJcbiAgICAgIGxhYmVsOiB0aGlzLnVzZXJUZXh0LFxyXG4gICAgICBuYW1lOiAnVXNlcicsXHJcbiAgICAgIHByb3BlcnR5OiAnVXNlcicsXHJcbiAgICAgIHRleHRQcm9wZXJ0eTogJ1VzZXJJbmZvJyxcclxuICAgICAgdGV4dFRlbXBsYXRlOiB0ZW1wbGF0ZS5uYW1lTEYsXHJcbiAgICAgIHR5cGU6ICdsb29rdXAnLFxyXG4gICAgICB2aWV3OiAndXNlcl9saXN0JyxcclxuICAgIH0sIHtcclxuICAgICAgbGFiZWw6IHRoaXMuc3RhcnREYXRlVGV4dCxcclxuICAgICAgbmFtZTogJ0Fzc2lnbmVkRGF0ZScsXHJcbiAgICAgIHByb3BlcnR5OiAnQXNzaWduZWREYXRlJyxcclxuICAgICAgdHlwZTogJ2RhdGUnLFxyXG4gICAgICBzaG93VGltZVBpY2tlcjogdHJ1ZSxcclxuICAgICAgZGF0ZUZvcm1hdFRleHQ6IChBcHAuaXMyNEhvdXJDbG9jaygpKSA/IHRoaXMuc3RhcnRpbmdGb3JtYXRUZXh0MjQgOiB0aGlzLnN0YXJ0aW5nRm9ybWF0VGV4dCxcclxuICAgICAgbWluVmFsdWU6IChuZXcgRGF0ZSgxOTAwLCAwLCAxKSksXHJcbiAgICAgIHZhbGlkYXRvcjogW1xyXG4gICAgICAgIHZhbGlkYXRvci5leGlzdHMsXHJcbiAgICAgICAgdmFsaWRhdG9yLmlzRGF0ZUluUmFuZ2UsXHJcbiAgICAgIF0sXHJcbiAgICB9LCB7XHJcbiAgICAgIGxhYmVsOiB0aGlzLmVuZERhdGVUZXh0LFxyXG4gICAgICBuYW1lOiAnQ29tcGxldGVkRGF0ZScsXHJcbiAgICAgIHByb3BlcnR5OiAnQ29tcGxldGVkRGF0ZScsXHJcbiAgICAgIHR5cGU6ICdkYXRlJyxcclxuICAgICAgc2hvd1RpbWVQaWNrZXI6IHRydWUsXHJcbiAgICAgIGRhdGVGb3JtYXRUZXh0OiAoQXBwLmlzMjRIb3VyQ2xvY2soKSkgPyB0aGlzLnN0YXJ0aW5nRm9ybWF0VGV4dDI0IDogdGhpcy5zdGFydGluZ0Zvcm1hdFRleHQsXHJcbiAgICAgIG1pblZhbHVlOiAobmV3IERhdGUoMTkwMCwgMCwgMSkpLFxyXG4gICAgICB2YWxpZGF0b3I6IFtcclxuICAgICAgICB2YWxpZGF0b3IuZXhpc3RzLFxyXG4gICAgICAgIHZhbGlkYXRvci5pc0RhdGVJblJhbmdlLFxyXG4gICAgICBdLFxyXG4gICAgfV0pO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgX19jbGFzcztcclxuIl19